// --- INTERNATIONALIZATION (i18n) ---
const translations = {
    es: {
        nav_home: "Inicio",
        nav_about: "Nosotros",
        nav_catalog: "CatÃ¡logo",
        nav_wholesale: "Mayoristas",
        nav_contact: "Contacto",
        search_placeholder: "Buscar...",
        hero_title: "Elegancia Natural",
        hero_subtitle: "Flores premium para momentos inolvidables.",
        hero_btn: "Ver ColecciÃ³n",
        hero_title_2: "Calidad ExportaciÃ³n",
        hero_subtitle_2: "Directo de la sabana de BogotÃ¡ a tus manos.",
        hero_title_3: "Frescura Garantizada",
        hero_subtitle_3: "DuraciÃ³n superior y colores vibrantes.",
        hero_title_4: "DiseÃ±o Floral",
        hero_subtitle_4: "Arte y naturaleza en cada arreglo.",
        value_title_1: "Calidad Tipo ExportaciÃ³n",
        value_desc_1: "Nuestras flores son seleccionadas de los mejores cultivos de la Sabana de BogotÃ¡, con estÃ¡ndares internacionales.",
        value_title_2: "Frescura Garantizada",
        value_desc_2: "Directo del cultivo a tus manos. Garantizamos una duraciÃ³n superior a 5 dÃ­as en florero con el cuidado adecuado.",
        value_title_3: "AtenciÃ³n Mayorista",
        value_desc_3: "Precios especiales para floristerÃ­as y eventos. Capacidad para grandes volÃºmenes con logÃ­stica especializada.",
        about_title: "Nuestra Historia",
        about_p1: "En JK IMPERIO hacemos algo sencillo pero potente: entregamos flores que cumplen con lo que prometen.",
        about_p2: "Nacimos para resolver un problema que conocemos bien â€”cuando organizÃ¡bamos eventos, siempre faltaban volÃºmenes, variedad o flores con calidad constanteâ€” asÃ­ que creamos una tienda virtual que combina stock mayorista, selecciÃ³n curada y una experiencia de compra pensada para quien vende y para quien regala.",
        about_p3: "Trabajamos directo con productores y centros de acopio, controlamos frescura y disponibilidad, y ofrecemos precios y presentaciones claras para compras al por mayor y al por menor. Si buscas volumen, trazabilidad y una atenciÃ³n que entiende tu negocio, JK IMPERIO estÃ¡ para que nunca te falten flores en el momento clave.",
        btn_contact: "ContÃ¡ctanos",
        shop_title: "Nuestras Flores",
        shop_subtitle: "La selecciÃ³n mÃ¡s exclusiva para tus momentos especiales.",
        filter_all: "Todas",
        filter_reds: "ðŸ”´ Rojas",
        filter_whites: "âšª Blancas",
        filter_pinks: "ðŸŒ¸ Rosadas",
        filter_yellows: "â˜€ï¸ Amarillas/Naranjas",
        filter_vintage: "ðŸ‚ Vintage",
        wholesale_title: "Aliados de tu Negocio",
        wholesale_desc: "Â¿Tienes una floristerÃ­a o organizas eventos? Accede a precios especiales y atenciÃ³n personalizada para compras al por mayor.",
        wholesale_btn: "SOLICITAR CATÃLOGO MAYORISTA",
        cart_title: "Tu Carrito ðŸŒ¸",
        cart_empty: "Tu carrito estÃ¡ vacÃ­o.",
        cart_checkout: "Confirmar Pedido (WhatsApp)",
        modal_desc: "ðŸ“ DescripciÃ³n",
        modal_occasion: "ðŸŽ‰ OcasiÃ³n Perfecta",
        modal_care: "ðŸ’§ Manual de Cuidado",
        modal_add: "Agregar al Carrito ðŸ›’",
        btn_add: "Agregar",
        stems_label: "24 Tallos"
    },
    en: {
        nav_home: "Home",
        nav_about: "About Us",
        nav_catalog: "Catalog",
        nav_wholesale: "Wholesale",
        nav_contact: "Contact",
        search_placeholder: "Search...",
        hero_title: "Natural Elegance",
        hero_subtitle: "Premium flowers for unforgettable moments.",
        hero_btn: "View Collection",
        hero_title_2: "Export Quality",
        hero_subtitle_2: "Direct from the Bogota savanna to your hands.",
        hero_title_3: "Guaranteed Freshness",
        hero_subtitle_3: "Superior duration and vibrant colors.",
        hero_title_4: "Floral Design",
        hero_subtitle_4: "Art and nature in every arrangement.",
        value_title_1: "Export Quality",
        value_desc_1: "Our flowers are selected from the best crops in the Bogota Savanna, with international standards.",
        value_title_2: "Guaranteed Freshness",
        value_desc_2: "Direct from the farm to your hands. We guarantee superior duration of 5+ days in vase with proper care.",
        value_title_3: "Wholesale Attention",
        value_desc_3: "Special prices for florists and events. Capacity for large volumes with specialized logistics.",
        about_title: "Our Story",
        about_p1: "At JK IMPERIO we do something simple but powerful: we deliver flowers that keep their promise.",
        about_p2: "We were born to solve a problem we know well â€”when we organized events, volume, variety, or consistent quality were always missingâ€” so we created a virtual store that combines wholesale stock, curated selection, and a shopping experience designed for those who sell and those who gift.",
        about_p3: "We work directly with producers and collection centers, control freshness and availability, and offer clear prices and presentations for wholesale and retail purchases. If you are looking for volume, traceability, and service that understands your business, JK IMPERIO is here so you never lack flowers at the key moment.",
        btn_contact: "Contact Us",
        shop_title: "Our Flowers",
        shop_subtitle: "The most exclusive selection for your special moments.",
        filter_all: "All",
        filter_reds: "ðŸ”´ Reds",
        filter_whites: "âšª Whites",
        filter_pinks: "ðŸŒ¸ Pinks",
        filter_yellows: "â˜€ï¸ Yellows/Oranges",
        filter_vintage: "ðŸ‚ Vintage",
        wholesale_title: "Business Partners",
        wholesale_desc: "Do you own a flower shop or organize events? Access special prices and personalized attention for wholesale purchases.",
        wholesale_btn: "REQUEST WHOLESALE CATALOG",
        cart_title: "Your Cart ðŸŒ¸",
        cart_empty: "Your cart is empty.",
        cart_checkout: "Checkout (WhatsApp)",
        modal_desc: "ðŸ“ Description",
        modal_occasion: "ðŸŽ‰ Perfect Occasion",
        modal_care: "ðŸ’§ Care Manual",
        modal_add: "Add to Cart ðŸ›’",
        btn_add: "Add",
        stems_label: "24 Stems"
    },
    // ... (Repeat for PT, IT, DE with placeholders or translations)
    // For brevity in this tool call, I will include key translations for other languages too to avoid 'undefined'
    pt: {
        nav_home: "InÃ­cio", nav_about: "Sobre NÃ³s", nav_catalog: "CatÃ¡logo", nav_wholesale: "Atacado", nav_contact: "Contato",
        search_placeholder: "Buscar...",
        about_title: "Nossa HistÃ³ria",
        about_p1: "Na JK IMPERIO fazemos algo simples mas poderoso: entregamos flores que cumprem o que prometem.",
        shop_title: "Nossas Flores", shop_subtitle: "A seleÃ§Ã£o mais exclusiva para seus momentos especiais.",
        wholesale_btn: "SOLICITAR CATÃLOGO DE ATACADO",
        hero_title: "ElegÃ¢ncia Natural",
        hero_subtitle: "Flores premium para momentos inesquecÃ­veis.",
        hero_btn: "Ver ColeÃ§Ã£o",
        hero_title_2: "Qualidade de ExportaÃ§Ã£o",
        hero_subtitle_2: "Direto da savana de BogotÃ¡ para suas mÃ£os.",
        hero_title_3: "Frescor Garantido",
        hero_subtitle_3: "DuraÃ§Ã£o superior e cores vibrantes.",
        hero_title_4: "Design Floral",
        hero_subtitle_4: "Arte e natureza em cada arranjo.",
        value_title_1: "Qualidade de ExportaÃ§Ã£o",
        value_desc_1: "Nossas flores sÃ£o selecionadas das melhores colheitas da Savana de BogotÃ¡, com padrÃµes internacionais.",
        value_title_2: "Frescor Garantido",
        value_desc_2: "Direto do cultivo para suas mÃ£os. Garantimos duraÃ§Ã£o superior a 5 dias no vaso com o cuidado adequado.",
        value_title_3: "Atendimento Atacadista",
        value_desc_3: "PreÃ§os especiais para floriculturas e eventos. Capacidade para grandes volumes com logÃ­stica especializada.",
        about_p2: "Nascemos para resolver um problema que conhecemos bem â€”quando organizÃ¡vamos eventos, sempre faltavam volumes, variedade ou flores com qualidade constanteâ€” assim criamos uma loja virtual que combina estoque de atacado, seleÃ§Ã£o curada e uma experiÃªncia de compra pensada para quem vende e para quem presenteia.",
        about_p3: "Trabalhamos direto com produtores e centros de coleta, controlamos frescor e disponibilidade, e oferecemos preÃ§os e apresentaÃ§Ãµes claras para compras no atacado e varejo. Se vocÃª busca volume, rastreabilidade e um atendimento que entende seu negÃ³cio, a JK IMPERIO estÃ¡ aqui para que nunca faltem flores no momento chave.",
        btn_contact: "Contate-nos",
        filter_all: "Todas", filter_reds: "ðŸ”´ Vermelhas", filter_whites: "âšª Brancas", filter_pinks: "ðŸŒ¸ Rosas", filter_yellows: "â˜€ï¸ Amarelas/Laranjas", filter_vintage: "ðŸ‚ Vintage",
        wholesale_title: "Parceiros do seu NegÃ³cio", wholesale_desc: "VocÃª tem uma floricultura ou organiza eventos? Acesse preÃ§os especiais e atendimento personalizado para compras no atacado.",
        cart_title: "Seu Carrinho ðŸŒ¸", cart_empty: "Seu carrinho estÃ¡ vazio.", cart_checkout: "Finalizar Pedido (WhatsApp)",
        modal_desc: "ðŸ“ DescriÃ§Ã£o", modal_occasion: "ðŸŽ‰ OcasiÃ£o Perfeita", modal_care: "ðŸ’§ Manual de Cuidado", modal_add: "Adicionar ao Carrinho ðŸ›’", btn_add: "Adicionar", stems_label: "24 Hastes"
    },
    it: {
        nav_home: "Home", nav_about: "Chi Siamo", nav_catalog: "Catalogo", nav_wholesale: "Ingrosso", nav_contact: "Contatto",
        search_placeholder: "Cerca...",
        about_title: "La Nostra Storia",
        about_p1: "In JK IMPERIO facciamo qualcosa di semplice ma potente: consegniamo fiori che mantengono ciÃ² che promettono.",
        shop_title: "I Nostri Fiori", shop_subtitle: "La selezione piÃ¹ esclusiva per i tuoi momenti speciali.",
        wholesale_btn: "RICHIEDI CATALOGO INGROSSO",
        hero_title: "Eleganza Naturale",
        hero_subtitle: "Fiori premium per momenti indimenticabili.",
        hero_btn: "Vedi Collezione",
        hero_title_2: "QualitÃ  Export",
        hero_subtitle_2: "Direttamente dalla savana di BogotÃ  alle tue mani.",
        hero_title_3: "Freschezza Garantita",
        hero_subtitle_3: "Durata superiore e colori vibranti.",
        hero_title_4: "Design Floreale",
        hero_subtitle_4: "Arte e natura in ogni composizione.",
        value_title_1: "QualitÃ  Export",
        value_desc_1: "I nostri fiori sono selezionati dalle migliori coltivazioni della Savana di BogotÃ , con standard internazionali.",
        value_title_2: "Freschezza Garantita",
        value_desc_2: "Direttamente dalla coltivazione alle tue mani. Garantiamo una durata superiore a 5 giorni nel vaso con la cura adeguata.",
        value_title_3: "Attenzione all'Ingrosso",
        value_desc_3: "Prezzi speciali per fioristi ed eventi. CapacitÃ  per grandi volumi con logistica specializzata.",
        about_p2: "Siamo nati per risolvere un problema che conosciamo bene â€”quando organizzavamo eventi, mancavano sempre volumi, varietÃ  o fiori con qualitÃ  costanteâ€” cosÃ¬ abbiamo creato un negozio virtuale che unisce stock all'ingrosso, selezione curata e un'esperienza di acquisto pensata per chi vende e per chi regala.",
        about_p3: "Lavoriamo direttamente con produttori e centri di raccolta, controlliamo freschezza e disponibilitÃ , e offriamo prezzi e presentazioni chiare per acquisti all'ingrosso e al dettaglio. Se cerchi volume, tracciabilitÃ  e un servizio che capisce il tuo business, JK IMPERIO Ã¨ qui affinchÃ© non manchino mai fiori nel momento chiave.",
        btn_contact: "Contattaci",
        filter_all: "Tutti", filter_reds: "ðŸ”´ Rossi", filter_whites: "âšª Bianchi", filter_pinks: "ðŸŒ¸ Rosa", filter_yellows: "â˜€ï¸ Gialli/Arancioni", filter_vintage: "ðŸ‚ Vintage",
        wholesale_title: "Partner del tuo Business", wholesale_desc: "Hai un fioraio o organizzi eventi? Accedi a prezzi speciali e attenzione personalizzata per acquisti all'ingrosso.",
        cart_title: "Il Tuo Carrello ðŸŒ¸", cart_empty: "Il tuo carrello Ã¨ vuoto.", cart_checkout: "Ordina (WhatsApp)",
        modal_desc: "ðŸ“ Descrizione", modal_occasion: "ðŸŽ‰ Occasione Perfetta", modal_care: "ðŸ’§ Istruzioni Cura", modal_add: "Aggiungi al Carrello ðŸ›’", btn_add: "Aggiungi", stems_label: "24 Steli"
    },
    de: {
        nav_home: "Startseite", nav_about: "Ãœber Uns", nav_catalog: "Katalog", nav_wholesale: "GroÃŸhandel", nav_contact: "Kontakt",
        search_placeholder: "Suchen...",
        about_title: "Unsere Geschichte",
        about_p1: "Bei JK IMPERIO machen wir etwas Einfaches, aber MÃ¤chtiges: Wir liefern Blumen, die halten, was sie versprechen.",
        shop_title: "Unsere Blumen", shop_subtitle: "Die exklusivste Auswahl fÃ¼r Ihre besonderen Momente.",
        wholesale_btn: "GROSSHANDELSKATALOG ANFORDERN",
        hero_title: "NatÃ¼rliche Eleganz",
        hero_subtitle: "Premium-Blumen fÃ¼r unvergessliche Momente.",
        hero_btn: "Kollektion ansehen",
        hero_title_2: "ExportqualitÃ¤t",
        hero_subtitle_2: "Direkt aus der Savanne von Bogota zu Ihnen.",
        hero_title_3: "Garantierte Frische",
        hero_subtitle_3: "Ãœberlegene Haltbarkeit und lebendige Farben.",
        hero_title_4: "Blumendesign",
        hero_subtitle_4: "Kunst und Natur in jedem Arrangement.",
        value_title_1: "ExportqualitÃ¤t",
        value_desc_1: "Unsere Blumen werden von den besten Kulturen der Savanne von Bogota ausgewÃ¤hlt, mit internationalen Standards.",
        value_title_2: "Garantierte Frische",
        value_desc_2: "Direkt vom Anbau zu Ihnen. Wir garantieren bei richtiger Pflege eine Haltbarkeit von Ã¼ber 5 Tagen in der Vase.",
        value_title_3: "GroÃŸhandelsservice",
        value_desc_3: "Sonderpreise fÃ¼r Floristen und Events. KapazitÃ¤t fÃ¼r groÃŸe Mengen mit spezialisierter Logistik.",
        about_p2: "Wir wurden geboren, um ein Problem zu lÃ¶sen, das wir gut kennen â€”wenn wir Events organisierten, fehlten immer Mengen, Vielfalt oder Blumen mit konstanter QualitÃ¤tâ€” also haben wir einen Online-Shop geschaffen, der GroÃŸhandelsbestand, kuratierte Auswahl und ein Einkaufserlebnis kombiniert, das fÃ¼r VerkÃ¤ufer und Schenkende gedacht ist.",
        about_p3: "Wir arbeiten direkt mit Produzenten und Sammelstellen zusammen, kontrollieren Frische und VerfÃ¼gbarkeit und bieten klare Preise und PrÃ¤sentationen fÃ¼r GroÃŸ- und EinzelhandelskÃ¤ufe. Wenn Sie Volumen, RÃ¼ckverfolgbarkeit und einen Service suchen, der Ihr GeschÃ¤ft versteht, ist JK IMPERIO da, damit Ihnen im entscheidenden Moment nie die Blumen fehlen.",
        btn_contact: "Kontaktieren Sie uns",
        filter_all: "Alle", filter_reds: "ðŸ”´ Rote", filter_whites: "âšª WeiÃŸe", filter_pinks: "ðŸŒ¸ Rosa", filter_yellows: "â˜€ï¸ Gelbe/Orange", filter_vintage: "ðŸ‚ Vintage",
        wholesale_title: "Partner Ihres GeschÃ¤fts", wholesale_desc: "Haben Sie einen Blumenladen oder organisieren Events? Greifen Sie auf Sonderpreise und personalisierte Betreuung fÃ¼r GroÃŸhandelseinkÃ¤ufe zu.",
        cart_title: "Ihr Warenkorb ðŸŒ¸", cart_empty: "Ihr Warenkorb ist leer.", cart_checkout: "Bestellung bestÃ¤tigen (WhatsApp)",
        modal_desc: "ðŸ“ Beschreibung", modal_occasion: "ðŸŽ‰ Perfekter Anlass", modal_care: "ðŸ’§ Pflegeanleitung", modal_add: "In den Warenkorb ðŸ›’", btn_add: "HinzufÃ¼gen", stems_label: "24 Stiele"
    }
};

let currentLang = localStorage.getItem('siteLang') || 'es';

function changeLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('siteLang', lang);

    // Update Floating Button Flag
    const currentFlag = document.getElementById('current-lang-flag');
    if (currentFlag) {
        const flagMap = { es: 'es', en: 'us', pt: 'br', it: 'it', de: 'de' };
        currentFlag.src = `https://flagcdn.com/w40/${flagMap[lang]}.png`;
    }

    // Translate Elements with data-i18n
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            // Check if element has innerHTML with strong tags (like first p of about)
            if (el.innerHTML.includes('<strong>') && translations[lang][key].includes('<strong>')) {
                el.innerHTML = translations[lang][key];
            } else if (el.tagName === 'INPUT') {
                el.placeholder = translations[lang][key];
            } else {
                el.innerText = translations[lang][key];
            }
        }
    });

    // Re-render Products
    if (typeof window.products !== 'undefined' && typeof renderProducts === 'function') {
        renderProducts(window.products);
    }

    // Dynamic Content
    updateDynamicContent();
}

// Re-render Products to apply translation (if products are available)
if (typeof window.products !== 'undefined' && typeof renderProducts === 'function') {
    renderProducts(window.products);
}

// Translate Dynamic Elements (Cart, etc. if needed)
updateDynamicContent();
}

function updateDynamicContent() {
    // Helper to update stuff like cart headers that might be dynamically rendered
    const cartTitle = document.querySelector('.sidebar-header h2');
    if (cartTitle) cartTitle.innerText = translations[currentLang].cart_title;

    const checkoutBtn = document.getElementById('checkout-btn');
    if (checkoutBtn) checkoutBtn.innerText = translations[currentLang].cart_checkout;
}

// Initialize Language on Load
document.addEventListener('DOMContentLoaded', () => {
    // --- Mobile Menu Toggle ---
    const menuToggle = document.querySelector('.menu-toggle');
    const mainNav = document.querySelector('.main-nav');

    if (menuToggle && mainNav) {
        menuToggle.addEventListener('click', () => {
            mainNav.classList.toggle('active');
            menuToggle.classList.toggle('open');
        });

        // Close menu when clicking a link
        document.querySelectorAll('.main-nav a').forEach(link => {
            link.addEventListener('click', () => {
                mainNav.classList.remove('active');
                menuToggle.classList.remove('open');
            });
        });
    }

    // --- Search Logic (New Modern Bar) ---
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');

    if (searchInput && searchBtn) {
        const performSearch = () => {
            const query = searchInput.value.toLowerCase().trim();
            if (!window.products) return;

            const filtered = window.products.filter(p =>
                p.name.toLowerCase().includes(query) ||
                p.type.toLowerCase().includes(query)
            );

            // Scroll to shop
            document.getElementById('shop-retail')?.scrollIntoView({ behavior: 'smooth' });
            renderProducts(filtered);
        };

        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });
    }

    // --- Hero Slider Logic ---
    const slides = document.querySelectorAll('.slide');
    const nextBtn = document.querySelector('.next-slide');
    const prevBtn = document.querySelector('.prev-slide');
    let currentSlide = 0;
    const slideInterval = 5000; // 5 seconds

    function showSlide(index) {
        slides.forEach(slide => slide.classList.remove('active'));
        currentSlide = (index + slides.length) % slides.length;
        slides[currentSlide].classList.add('active');
    }

    function nextSlide() {
        showSlide(currentSlide + 1);
    }

    function prevSlide() {
        showSlide(currentSlide - 1);
    }

    if (slides.length > 0) {
        if (nextBtn) nextBtn.addEventListener('click', nextSlide);
        if (prevBtn) prevBtn.addEventListener('click', prevSlide);

        // Auto-play
        setInterval(nextSlide, slideInterval);
    }

    // --- Product Catalog (Global for i18n) ---
    window.products = [
        // Reds
        {
            id: 1,
            name: 'Velvet Night',
            type: 'Rosa Freedom',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/freedom.jpg',
            category: 'reds',
            price: 119900,
            isBestSeller: true,
            description: 'El estÃ¡ndar de oro en rosas rojas. Con su color rojo carmesÃ­ profundo y aterciopelado, la Freedom es sÃ­mbolo de amor eterno y pasiÃ³n intensa. Sus pÃ©talos de apertura perfecta y tallos robustos garantizan una presencia imponente y duradera.',
            occasion: 'Aniversarios, San ValentÃ­n, propuestas de matrimonio y declaraciones de amor apasionadas.',
            care: ['Recortar tallos 2cm en diagonal.', 'Usar agua frÃ­a y cambiar cada 2 dÃ­as.', 'Evitar sol directo y corrientes de aire.']
        },
        // Wait, the file content is too large to move entirely in one go if I include all 30 products text.
        // I will keep the products array where it is for a moment, but assign it to window.products

        {
            id: 2,
            name: 'Crimson Explorer',
            type: 'Rosa Explorer',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/freedom.jpg',
            category: 'reds',
            price: 124900,
            description: 'SofisticaciÃ³n y misterio en cada pÃ©talo. La rosa Explorer destaca por su tono rojo oscuro intenso y su increÃ­ble durabilidad. Su textura aterciopelada y apertura lenta la convierten en una obra de arte floral de lujo.',
            occasion: 'Eventos de gala, cenas romÃ¡nticas elegantes y decoraciÃ³n de interiores sofisticada.',
            care: ['Retirar pÃ©talos guardas externos si es necesario.', 'Hidratar profundamente.', 'Ideal para ambientes frescos.']
        },
        {
            id: 3,
            name: 'Royal Red',
            type: 'Rosa Red France',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/Ragazza.jpg',
            category: 'reds',
            price: 119900,
            description: 'Un clÃ¡sico francÃ©s de elegancia atemporal. Sus pÃ©talos se despliegan en una forma de copa perfecta, revelando un rojo vibrante y luminoso. Ideal para quienes buscan tradiciÃ³n y belleza sin excesos.',
            occasion: 'CumpleaÃ±os, agradecimientos y gestos romÃ¡nticos clÃ¡sicos.',
            care: ['Cortar tallos bajo el agua.', 'Mantener el florero lleno al 75%.', 'Rociar los pÃ©talos suavemente.']
        },

        // Whites & Creams
        {
            id: 4,
            name: 'Moonlight',
            type: 'Rosa Mondial',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/Mondial.jpg',
            category: 'whites',
            price: 129900,
            isExclusive: true,
            description: 'Conocida como la "Rosa de las Novias", la Mondial posee un blanco cremoso con sutiles toques verdes en los bordes. Simboliza pureza y unidad, con una apertura majestuosa y pÃ©talos rizados.',
            occasion: 'Bodas, bautizos, condolencias y decoraciÃ³n minimalista.',
            care: ['Retirar hojas que toquen el agua.', 'Agua tibia para acelerar apertura.', 'Luz indirecta brillante.']
        },
        {
            id: 5,
            name: 'Pure Snow',
            type: 'Rosa Playa Blanca',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/playa_blanca.jpg',
            category: 'whites',
            price: 134900,
            description: 'Blancura pura y radiante. Playa Blanca es una rosa de jardÃ­n con una cantidad excepcional de pÃ©talos que crean un centro denso y lujoso. Su color blanco puro ilumina cualquier espacio con serenidad.',
            occasion: 'Eventos "all-white", centros de mesa lujosos y regalos de paz.',
            care: ['Requiere mucha agua, revisar nivel diario.', 'Cortar tallos cada 3 dÃ­as.', 'Evitar calor excesivo.']
        },
        {
            id: 6,
            name: 'Ivory Dream',
            type: 'Rosa Vendela',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/vendela.jpg',
            category: 'whites',
            price: 124900,
            description: 'La elegancia del color marfil. Vendela es famosa por su tono crema champÃ¡n delicado y su forma clÃ¡sica. Aporta calidez y distinciÃ³n, siendo una favorita para combinar con otros colores suaves.',
            occasion: 'Bodas vintage, aniversarios de oro y decoraciÃ³n clÃ¡sica.',
            care: ['Limpiar el florero con cloro antes de usar.', 'Agua fresca.', 'Retirar flores marchitas.']
        },
        {
            id: 7,
            name: 'White Cloud',
            type: 'Rosa White Chocolate',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/Snow-Bliss.jpg',
            category: 'whites',
            price: 129900,
            description: 'Densa, enorme y cremosa como el chocolate blanco. Esta variedad destaca por el tamaÃ±o gigante de su cabeza floral y sus pÃ©talos gruesos que le otorgan una vida en florero superior.',
            occasion: 'Grandes arreglos florales, regalos impactantes y decoraciÃ³n de hoteles.',
            care: ['Soporte adecuado para el peso de la flor.', 'HidrataciÃ³n constante.', 'Cortar en bisel profundo.']
        },

        // Pinks & Magentas
        {
            id: 8,
            name: 'Pink Floyd',
            type: 'Rosa Pink Floyd',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/Pink-Floyd.jpg',
            category: 'pinks',
            price: 134900,
            isBestSeller: true,
            description: 'Vibrante, elÃ©ctrica e inolvidable. Pink Floyd es una rosa fucsia intenso que roba todas las miradas. Su color saturado y gran tamaÃ±o la convierten en el centro de atenciÃ³n indiscutible.',
            occasion: 'CumpleaÃ±os alegres, fiestas de 15 aÃ±os y celebraciones vibrantes.',
            care: ['Mucha luz indirecta para mantener el color.', 'Agua limpia diaria.', 'Nutriente floral recomendado.']
        },
        {
            id: 9,
            name: 'Sweet Berry',
            type: 'Rosa Queen Berry',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/Queen-Barry.jpg',
            category: 'pinks',
            price: 129900,
            description: 'Un rosa frambuesa profundo y seductor. Queen Berry ofrece un color rico y sofisticado, perfecto para transmitir admiraciÃ³n y gratitud con un toque moderno y chic.',
            occasion: 'DÃ­a de la Madre, agradecimientos corporativos y citas romÃ¡nticas.',
            care: ['Cortar tallos regularmente.', 'Evitar frutas cerca (etileno).', 'Lugar fresco de noche.']
        },
        {
            id: 10,
            name: 'Rosalinda',
            type: 'Rosa Pink Mondial',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/pink-mondial.jpg',
            category: 'pinks',
            price: 129900,
            isNew: true,
            description: 'Suavidad y romanticismo en rosa pastel. Pink Mondial es la hermana rosada de la famosa Mondial, compartiendo sus pÃ©talos rizados y su larga duraciÃ³n, pero con un rubor rosado de ensueÃ±o.',
            occasion: 'Baby showers, bodas romÃ¡nticas y regalos de ternura.',
            care: ['Tratar con delicadeza los pÃ©talos.', 'Agua siempre limpia.', 'Evitar luz solar directa.']
        },

        {
            id: 11,
            name: 'Fuchsia Pop',
            type: 'Rosa Topaz',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/Tabatha_01.jpg',
            category: 'pinks',
            price: 124900,
            description: 'EnergÃ­a pura en color fucsia brillante. Topaz es una rosa alegre y luminosa, con pÃ©talos que parecen brillar. Perfecta para levantar el Ã¡nimo y celebrar la vida con color.',
            occasion: 'Graduaciones, ascensos laborales y festejos con amigos.',
            care: ['Cambiar agua cada 2 dÃ­as.', 'Recorte de tallos frecuente.', 'Mantener alejada de fuentes de calor.']
        },
        {
            id: 12,
            name: 'Blush Kiss',
            type: 'Rosa Jesika',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/jesika.jpg',
            category: 'pinks',
            price: 129900,
            description: 'Dulce y delicada. Jesika presenta un tono rosa suave y equilibrado, clÃ¡sico y femenino. Sus botones tienen una forma elegante que se abre lentamente para mostrar su belleza.',
            occasion: 'Primera cita, aniversarios de mes y detalles dulces.',
            care: ['HidrataciÃ³n media.', 'Limpiar follaje sumergido.', 'Temperatura ambiente constante.']
        },
        {
            id: 13,
            name: 'Candy Crush',
            type: 'Rosa Frutetto',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/frutetto.jpg',
            category: 'pinks',
            price: 129900,
            description: 'Un rosa medio vibrante con corazÃ³n verdoso. Frutetto es fresca y juvenil, evocando la alegrÃ­a de la primavera. Su color Ãºnico aporta dinamismo a cualquier arreglo.',
            occasion: 'CumpleaÃ±os de amigas, brunchs y regalos casuales.',
            care: ['Agua frÃ­a.', 'Nutriente floral vital.', 'Cortar 2cm cada 3 dÃ­as.']
        },
        {
            id: 14,
            name: 'Soft Petal',
            type: 'Rosa Blessing',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/blessing.jpg',
            category: 'pinks',
            price: 124900,
            description: 'BendiciÃ³n de color. Blessing es una rosa de tono rosa coral suave, cÃ¡lida y acogedora. Transmite calma y felicidad con su apertura amplia y generosa.',
            occasion: 'RecuperaciÃ³n de salud, dar Ã¡nimos y visitas familiares.',
            care: ['Mucha agua.', 'Luz natural indirecta.', 'Retirar pÃ©talos marchitos.']
        },
        {
            id: 15,
            name: 'Vibrant Soul',
            type: 'Rosa Alive',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/Alive-2.jpg',
            category: 'pinks',
            price: 129900,
            description: 'Intensidad que deslumbra. Alive es una rosa de color coral-naranja vibrante y encendido. Representa energÃ­a, entusiasmo y pasiÃ³n por la vida. Imposible de ignorar.',
            occasion: 'Celebraciones de logros, inauguraciones y eventos creativos.',
            care: ['HidrataciÃ³n profunda.', 'Evitar aire acondicionado directo.', 'Cambio de agua frecuente.']
        },
        {
            id: 16,
            name: 'Morning Dew',
            type: 'Rosa New Face',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/new_face.jpg',
            category: 'pinks',
            price: 124900,
            description: 'Frescura matutina. New Face suele presentar tonos rosa salmÃ³n suave, a veces con matices naranja. Es una rosa alegre y versÃ¡til que ilumina cualquier habitaciÃ³n.',
            occasion: 'Desayunos sorpresa, cumpleaÃ±os y arreglos de dÃ­a.',
            care: ['Agua fresca.', 'Corte en bisel.', 'Luz clara pero no directa.']
        },

        // Yellows & Oranges
        {
            id: 17,
            name: 'Solar Flare',
            type: 'Rosa High & Magic',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/high-and-magic.jpg',
            category: 'yellows',
            price: 124900,
            isBestSeller: true,
            description: 'Magia de fuego. High & Magic es una rosa bicolor impresionante con base amarilla y bordes rojos intensos, como una llama viva. Aporta energÃ­a y calidez instantÃ¡nea.',
            occasion: 'Hombres, Ã©xitos corporativos y personas con personalidad fuerte.',
            care: ['Agua abundante.', 'Evitar calor extremo.', 'Cortar tallos cada 2 dÃ­as.']
        },
        {
            id: 18,
            name: 'Sunset Glow',
            type: 'Rosa Orange Crush',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/orange-crush.jpg',
            category: 'yellows',
            price: 129900,
            description: 'El naranja por excelencia. Orange Crush ofrece un tono naranja puro, saturado y brillante. Es sinÃ³nimo de diversiÃ³n, creatividad y Ã©xito vibrante.',
            occasion: 'Fiestas temÃ¡ticas, Halloween, OtoÃ±o y celebraciones creativas.',
            care: ['HidrataciÃ³n constante.', 'Nutriente floral necesario.', 'Ambiente fresco.']
        },
        {
            id: 19,
            name: 'Golden Hour',
            type: 'Rosa Brighton',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/Super-Sun_01.jpg',
            category: 'yellows',
            price: 124900,
            description: 'Amarillo sol radiante. Brighton es una rosa amarilla pura, grande y luminosa. Representa amistad, alegrÃ­a y nuevos comienzos con una luz propia inigualable.',
            occasion: 'DÃ­a de la Amistad, graduaciones y para desear buen camino.',
            care: ['Retirar hojas bajas.', 'Agua limpia siempre.', 'Evitar luz solar directa fuerte.']
        },
        {
            id: 20,
            name: 'High Pure',
            type: 'Rosa High Pure',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/high-and-pure.jpg',
            category: 'yellows',
            price: 129900,
            description: 'Contraste elegante. High Pure combina un blanco puro en el centro con un verde fresco y vibrante en los pÃ©talos exteriores. Una rosa moderna y chic para gustos refinados.',
            occasion: 'DecoraciÃ³n moderna, oficinas y regalos para arquitectos/diseÃ±adores.',
            care: ['Agua frÃ­a.', 'Cambio diario de agua.', 'Corte en diagonal.']
        },

        // Lavenders & Unique
        {
            id: 21,
            name: 'Mystic Purple',
            type: 'Rosa Moody Blues',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/moody-blues.jpg',
            category: 'vintage',
            price: 139900,
            isExclusive: true,
            description: 'Drama en color lavanda. Moody Blues ofrece un tono lila intenso y saturado con bordes oscuros, creando un efecto de profundidad y misterio fascinante. Ãšnica en su clase.',
            occasion: 'Eventos nocturnos de lujo, regalos originales y amantes del morado.',
            care: ['HidrataciÃ³n crÃ­tica.', 'Evitar corrientes de aire.', 'Cortar tallos bajo agua.']
        },
        {
            id: 22,
            name: 'Lavender Dream',
            type: 'Rosa Jacaranda',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/jacaranda.jpg',
            category: 'vintage',
            price: 134900,
            description: 'Fucsia violÃ¡ceo vibrante. Jacaranda camina entre el rosa intenso y el lila. Es una rosa con carÃ¡cter, perfecta para quienes buscan algo fuera de lo comÃºn pero hermoso.',
            occasion: 'CumpleaÃ±os, moda y eventos artÃ­sticos.',
            care: ['Mucha agua.', 'Nutriente floral.', 'Luz indirecta.']
        },
        {
            id: 23,
            name: 'Blueberry Frost',
            type: 'Rosa Blueberry',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/blueberry_02-1.jpg',
            category: 'vintage',
            price: 139900,
            isNew: true,
            description: 'El tono exacto del arÃ¡ndano. Blueberry es una rosa lavanda oscura, casi pÃºrpura, con una textura rica y sofisticada. Aporta un toque de realeza y calma.',
            occasion: 'MeditaciÃ³n, espacios de relajaciÃ³n y regalos sobrios.',
            care: ['Agua fresca y limpia.', 'Recorte regular de tallos.', 'Ambiente fresco.']
        },
        {
            id: 24,
            name: 'Ocean Mist',
            type: 'Rosa Kendal',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/kendal.jpg',
            category: 'vintage',
            price: 134900,
            description: 'Lavanda suave y etÃ©reo. Kendal es una rosa de color lila pastel, delicada y soÃ±adora. Perfecta para composiciones florales que buscan transmitir serenidad y fantasÃ­a.',
            occasion: 'QuinceaÃ±eras, baby showers y decoraciones etÃ©reas.',
            care: ['Trato delicado.', 'Agua limpia diaria.', 'Evitar calor.']
        },

        // Peaches & Earth Tones
        {
            id: 25,
            name: 'Vintage Peach',
            type: 'Rosa Kahala',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/Almah_01.jpg',
            category: 'vintage',
            price: 139900,
            description: 'El encanto vintage hecho flor. Kahala presenta una mezcla Ãºnica de durazno, crema y terracota, con una apertura en forma de jardÃ­n. La favorita de las novias boho-chic.',
            occasion: 'Bodas estilo boho, decoraciÃ³n rÃºstica y otoÃ±o.',
            care: ['Retirar pÃ©talos externos con cuidado.', 'Mucha agua.', 'Luz natural.']
        },
        {
            id: 26,
            name: 'Sandstorm',
            type: 'Rosa Quicksand',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/cuenca.jpg',
            category: 'vintage',
            price: 134900,
            description: 'Arena rosa del desierto. Quicksand es famosa por su color beige arena con toques rosados sutiles. Neutra, elegante y moderna, combina con absolutamente todo.',
            occasion: 'Bodas modernas, decoraciÃ³n minimalista y eventos corporativos.',
            care: ['HidrataciÃ³n media.', 'Cortar tallos en bisel.', 'Ambiente libre de humo.']
        },
        {
            id: 27,
            name: 'Sweet Nectar',
            type: 'Rosa Be Sweet',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/besweet.jpg',
            category: 'pinks',
            price: 129900,
            description: 'Dulcura en rosa pÃ¡lido con bordes oscuros o toques crema. Be Sweet es tierna y romÃ¡ntica, con un aire de inocencia y dulzura clÃ¡sica.',
            occasion: 'Nacimientos, regalos para niÃ±as y detalles dulces.',
            care: ['Agua limpia.', 'Nutriente floral.', 'Evitar sol fuerte.']
        },
        {
            id: 28,
            name: 'Impressionist',
            type: 'Rosa Impression',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/impression.jpg',
            category: 'vintage',
            price: 129900,
            description: 'Arte en cada pÃ©talo. Impression suele presentar bicolores o texturas que parecen pintadas a mano, ofreciendo una experiencia visual rica y texturizada.',
            occasion: 'Regalos para artistas, galerÃ­as y personas creativas.',
            care: ['Cambiar agua cada 2 dÃ­as.', 'Recortar tallos.', 'Luz indirecta.']
        },
        {
            id: 29,
            name: 'Gemstone',
            type: 'Rosa Gemstone',
            image: 'https://casuparoses.com/wp-content/uploads/2024/11/gemstone.jpg',
            category: 'vintage',
            price: 129900,
            description: 'Una joya floral. Gemstone brilla con tonos rosados vibrantes y una forma perfecta. Es una rosa duradera y fuerte, como una piedra preciosa tallada.',
            occasion: 'Aniversarios importantes, joyas florales y eventos de lujo.',
            care: ['HidrataciÃ³n profunda.', 'Agua frÃ­a.', 'Cortar 2cm cada 3 dÃ­as.']
        },
        {
            id: 30,
            name: 'Stardust',
            type: 'Rosa Stardust',
            image: 'https://casuparoses.com/wp-content/uploads/2024/12/stardust.jpg',
            category: 'yellows',
            price: 134900,
            isNew: true,
            description: 'Polvo de estrellas dorado. Stardust es una rosa amarilla intensa, a veces con bordes rojizos difusos, que brilla con luz propia. Aporta felicidad y opulencia.',
            occasion: 'Celebraciones de AÃ±o Nuevo, Ã©xitos dorados y fiestas nocturnas.',
            care: ['Mucha agua necesaria.', 'Evitar calor radiante.', 'Nutriente floral.']
        }
    ];

    // --- SEARCH & CART LOGIC ---
    const productGrid = document.querySelector('.product-grid');
    const filterBtns = document.querySelectorAll('.filter-btn');
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');

    // Cart State
    let cart = [];
    const cartBtn = document.getElementById('cart-btn');
    const cartModal = document.getElementById('cart-modal');
    const closeSidebar = document.querySelector('.close-sidebar');
    const cartItemsContainer = document.getElementById('cart-items');
    const cartTotalPrice = document.getElementById('cart-total-price');
    const cartCountElement = document.querySelector('.cart-count');
    const checkoutBtn = document.getElementById('checkout-btn');

    // Helper: Format Price
    const formatPrice = (price) => {
        return new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 }).format(price);
    };

    // --- Global Pricing ---
    const PRICE_DOCENA = 40000;

    // --- RENDER PRODUCTS ---
    function renderProducts(items) {
        if (!productGrid) return;
        productGrid.innerHTML = '';

        if (items.length === 0) {
            productGrid.innerHTML = '<div class="no-results" style="grid-column: 1/-1; text-align: center; padding: 50px;">No encontramos flores con ese nombre ðŸ¥€</div>';
            return;
        }

        items.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card animate-on-scroll';

            let badgeHTML = '';
            if (product.isBestSeller) badgeHTML = '<span class="badge badge-bestseller">MÃ¡s Vendido</span>';
            else if (product.isNew) badgeHTML = '<span class="badge badge-new">Nuevo</span>';
            else if (product.isExclusive) badgeHTML = '<span class="badge badge-exclusive">Exclusivo</span>';
            else badgeHTML = '<span class="badge badge-quality">Tipo ExportaciÃ³n</span>';

            card.innerHTML = `
                <div class="product-image">
                    ${badgeHTML}
                    <img src="${product.image}" alt="${product.name}" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1562690868-60bbe7293e94?q=80&w=2187&auto=format&fit=crop'">
                    <div class="card-overlay">
                        <button class="btn-quick-view" onclick="openModal(${product.id})">Ver Detalles</button>
                    </div>
                </div>
                <div class="product-info">
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-type">${product.type} â€¢ <span data-i18n="stems_label">${translations[currentLang].stems_label}</span></p>
                    <div class="product-meta">
                        <p class="product-price">${formatPrice(PRICE_DOCENA)}</p>
                        <button class="btn-add-cart" onclick="addToCart(${product.id})">ðŸ›’</button>
                    </div>
                </div>
            `;
            productGrid.appendChild(card);
        });
    }

    // --- FILTER LOGIC ---
    filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            filterBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const category = btn.getAttribute('data-filter');
            if (category === 'all') {
                renderProducts(products);
            } else {
                renderProducts(products.filter(p => p.category === category));
            }
        });
    });

    // --- SEARCH LOGIC (Live Dropdown) ---
    const searchResults = document.getElementById('search-results');

    if (searchBtn && searchInput && searchResults) {
        // Toggle Search Bar
        // Toggle Search Overlay
        searchBtn.addEventListener('click', () => {
            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
                document.body.classList.toggle('search-active');
                const isActive = document.body.classList.contains('search-active');

                if (isActive) {
                    searchInput.classList.add('active');
                    setTimeout(() => searchInput.focus(), 100);
                    searchBtn.innerHTML = 'âœ•'; // Change to X
                } else {
                    searchInput.classList.remove('active');
                    searchResults.style.display = 'none';
                    searchBtn.innerHTML = 'ðŸ”'; // Change back to coin
                    searchInput.value = ''; // Clear on close
                }
            } else {
                // Desktop behavior (existing)
                searchInput.classList.toggle('active');
                if (searchInput.classList.contains('active')) {
                    searchInput.focus();
                } else {
                    searchResults.style.display = 'none';
                }
            }
        });

        // Live Search Input
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();

            if (term.length === 0) {
                searchResults.style.display = 'none';
                return;
            }

            const filtered = products.filter(p =>
                p.name.toLowerCase().includes(term) ||
                p.type.toLowerCase().includes(term) ||
                p.description.toLowerCase().includes(term)
            );

            displaySearchResults(filtered);
        });

        // Display Results in Dropdown
        function displaySearchResults(items) {
            searchResults.innerHTML = '';

            if (items.length === 0) {
                searchResults.innerHTML = '<div class="search-no-results">No se encontraron flores ðŸ¥€</div>';
            } else {
                items.forEach(product => {
                    const div = document.createElement('div');
                    div.className = 'search-item';
                    div.innerHTML = `
                        <img src="${product.image}" alt="${product.name}">
                        <div class="search-item-info">
                            <h4>${product.name}</h4>
                            <p>${product.type}</p>
                            <span>${formatPrice(PRICE_DOCENA)}</span>
                        </div>
                    `;
                    div.addEventListener('click', () => {
                        openModal(product.id);
                        searchResults.style.display = 'none'; // Close after selection
                        searchInput.value = ''; // Optional: clear input
                    });
                    searchResults.appendChild(div);
                });
            }
            searchResults.style.display = 'block';
        }

        // Close search results when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                searchResults.style.display = 'none';
            }
        });
    }

    // --- CART FUNCTIONS ---
    function toggleCart() {
        if (cartModal) cartModal.classList.toggle('show');
    }

    if (cartBtn) cartBtn.addEventListener('click', (e) => {
        e.preventDefault();
        toggleCart();
    });

    if (closeSidebar) closeSidebar.addEventListener('click', toggleCart);

    // Make available globally for inline onclicks
    window.addToCart = function (id) {
        const product = products.find(p => p.id === id);
        if (product) {
            // Updated logic: Single default variant (Docena), Price 40k
            const existingItem = cart.find(item => item.id === id);

            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    ...product,
                    quantity: 1,
                    price: PRICE_DOCENA // Use new fixed price
                });
            }
            updateCartUI();
            if (cartModal && !cartModal.classList.contains('show')) {
                toggleCart();
            }
        }
    };

    window.increaseQuantity = function (id) {
        const item = cart.find(item => item.id === id);
        if (item) {
            item.quantity++;
            updateCartUI();
        }
    };

    window.decreaseQuantity = function (id) {
        const item = cart.find(item => item.id === id);
        if (item) {
            item.quantity--;
            if (item.quantity <= 0) {
                cart = cart.filter(i => i.id !== id);
            }
            updateCartUI();
        }
    };

    window.removeFromCart = function (id) {
        cart = cart.filter(item => item.id !== id);
        updateCartUI();
    };

    function updateCartUI() {
        // Calculate Total Items
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

        // Update Count
        if (cartCountElement) {
            cartCountElement.textContent = totalItems;
            cartCountElement.classList.add('bump');
            setTimeout(() => cartCountElement.classList.remove('bump'), 300);
        }

        // Update Items and Total
        if (cartItemsContainer && cartTotalPrice) {
            cartItemsContainer.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<div class="empty-cart-msg">Tu carrito estÃ¡ vacÃ­o ðŸ¥€</div>';
            } else {
                cart.forEach((item) => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;

                    const itemEl = document.createElement('div');
                    itemEl.className = 'cart-item';
                    itemEl.innerHTML = `
                        <img src="${item.image}" alt="${item.name}">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-type" style="font-size: 0.8rem; color: #666;">Docena (12 Tallos)</div>
                            <div class="cart-item-price">$${item.price.toLocaleString()}</div>
                            <div class="cart-controls">
                                <button class="qty-btn" onclick="decreaseQuantity(${item.id})">-</button>
                                <span class="qty-val">${item.quantity}</span>
                                <button class="qty-btn" onclick="increaseQuantity(${item.id})">+</button>
                            </div>
                        </div>
                        <div class="cart-item-total">
                            $${itemTotal.toLocaleString()}
                        </div>
                        <div class="cart-item-remove" onclick="removeFromCart(${item.id})" title="Eliminar">&times;</div>
                    `;
                    cartItemsContainer.appendChild(itemEl);
                });
            }
            cartTotalPrice.textContent = '$' + total.toLocaleString();
        }
    }

    if (checkoutBtn) {
        checkoutBtn.addEventListener('click', () => {
            if (cart.length === 0) return;
            let message = "Hola JK IMPERIO, deseo realizar el siguiente pedido: \n\n";
            let total = 0;
            cart.forEach(item => {
                const subtotal = item.price * item.quantity;
                message += `â–ªï¸ *(${item.quantity})* ${item.name} [Docena] - $${subtotal.toLocaleString()}\n`;
                total += subtotal;
            });
            message += `\nðŸŒº *TOTAL A PAGAR: $${total.toLocaleString()}*`;
            window.open(`https://wa.me/573002963698?text=${encodeURIComponent(message)}`, '_blank');
        });
    }

    // --- MODAL LOGIC (Global) ---
    const modal = document.getElementById('product-modal');
    const closeModal = document.querySelector('.close-modal');
    // Model elements
    const modalImg = document.getElementById('modal-img');
    const modalTitle = document.getElementById('modal-title');
    const modalType = document.getElementById('modal-type');
    const modalDesc = document.getElementById('modal-desc');
    const modalOccasion = document.getElementById('modal-occasion');
    const modalCare = document.getElementById('modal-care');
    const modalAddCart = document.getElementById('modal-add-cart'); // The 'Add to Cart' inside modal
    const modalPrice = document.getElementById('modal-price'); // Price inside modal if exists

    // Clean up any stale variant container if it exists
    const staleVariantContainer = document.getElementById('variant-container');
    if (staleVariantContainer) {
        staleVariantContainer.remove();
    }

    window.openModal = function (id) {
        const product = products.find(p => p.id === id);
        if (!product) return;

        if (modalImg) modalImg.src = product.image;
        if (modalTitle) modalTitle.textContent = product.name;
        if (modalType) modalType.textContent = product.type;
        if (modalDesc) modalDesc.textContent = product.description;
        if (modalOccasion) modalOccasion.textContent = product.occasion || 'Perfecto para cualquier ocasiÃ³n especial.';

        // Populate Care Instructions
        if (modalCare) {
            modalCare.innerHTML = '';
            const careTips = product.care || ['Cambiar agua cada 2 dÃ­as', 'Cortar tallos en diagonal', 'Evitar sol directo'];
            careTips.forEach(tip => {
                const li = document.createElement('li');
                li.textContent = tip;
                modalCare.appendChild(li);
            });
        }

        // Modal Price (Fixed)
        if (modalPrice) {
            modalPrice.textContent = formatPrice(PRICE_DOCENA);
        }

        // Configure "Add to Cart" button in modal
        if (modalAddCart) {
            modalAddCart.onclick = function () {
                window.addToCart(product.id);
                if (modal) {
                    modal.classList.remove('show');
                    setTimeout(() => modal.style.display = 'none', 300);
                }
            };
            modalAddCart.textContent = 'Agregar al Carrito ðŸ›’';
        }

        if (modal) {
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
        }
    };

    if (closeModal) {
        closeModal.onclick = () => {
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.style.display = 'none', 300);
            }
        };
    }

    window.onclick = (e) => {
        if (modal && e.target === modal) {
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 300);
        }
        if (cartModal && e.target === cartModal) {
            toggleCart();
        }
    };

    // Initial Render
    // Initial Render
    changeLanguage(currentLang);

});
